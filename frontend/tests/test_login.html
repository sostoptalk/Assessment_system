<!DOCTYPE html>
<html>

<head>
    <title>登录测试</title>
    <meta charset="utf-8">
</head>

<body>
    <h2>登录测试</h2>
    <form id="loginForm">
        <div>
            <label>用户名:</label>
            <input type="text" id="username" value="admin" />
        </div>
        <div>
            <label>密码:</label>
            <input type="password" id="password" value="admin123" />
        </div>
        <button type="submit">登录</button>
    </form>

    <div id="result"></div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');

            try {
                // 登录
                const formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);

                const loginResponse = await fetch('/api/login', {
                    method: 'POST',
                    body: formData
                });

                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    const token = loginData.access_token;

                    resultDiv.innerHTML = `<p>✅ 登录成功! Token: ${token.substring(0, 20)}...</p>`;

                    // 获取用户信息
                    const meResponse = await fetch('/api/me/', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (meResponse.ok) {
                        const userData = await meResponse.json();
                        resultDiv.innerHTML += `<p>✅ 用户信息: ${JSON.stringify(userData)}</p>`;
                    } else {
                        resultDiv.innerHTML += `<p>❌ 获取用户信息失败: ${meResponse.status}</p>`;
                    }
                } else {
                    resultDiv.innerHTML = `<p>❌ 登录失败: ${loginResponse.status}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p>❌ 网络错误: ${error.message}</p>`;
            }
        });
    </script>
</body>

</html>