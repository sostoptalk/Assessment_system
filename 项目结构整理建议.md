# 人才测评平台 - 项目结构整理建议

## 当前问题分析

### 1. 根目录文件过多
- 大量测试文件（test_*.py, test_*.html）散布在根目录
- 生成器文件（generator.py, generator2.py, chart_generator.py）位置不当
- 数据库脚本文件分散

### 2. 前后端代码混合
- 前端代码在 `src/` 目录
- 后端代码在根目录的 `app.py`
- 缺乏清晰的分层结构

### 3. 配置文件混乱
- 数据库脚本在根目录
- 配置文件位置不统一

## 建议的新项目结构

```
Assessment_system/
├── README.md                    # 项目主说明文档
├── requirements.txt             # Python依赖
├── package.json                 # Node.js依赖
├── .gitignore                   # Git忽略文件
├── .env.example                 # 环境变量示例
├── docker-compose.yml           # Docker编排文件
│
├── backend/                     # 后端代码目录
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py              # FastAPI主程序（原app.py）
│   │   ├── models/              # 数据模型
│   │   │   ├── __init__.py
│   │   │   ├── user.py
│   │   │   ├── question.py
│   │   │   ├── paper.py
│   │   │   └── dimension.py
│   │   ├── schemas/             # Pydantic模型
│   │   │   ├── __init__.py
│   │   │   ├── user.py
│   │   │   ├── question.py
│   │   │   └── paper.py
│   │   ├── api/                 # API路由
│   │   │   ├── __init__.py
│   │   │   ├── auth.py
│   │   │   ├── questions.py
│   │   │   ├── papers.py
│   │   │   ├── participants.py
│   │   │   └── dashboard.py
│   │   ├── core/                # 核心配置
│   │   │   ├── __init__.py
│   │   │   ├── config.py
│   │   │   ├── database.py
│   │   │   └── security.py
│   │   ├── services/            # 业务逻辑
│   │   │   ├── __init__.py
│   │   │   ├── auth_service.py
│   │   │   ├── question_service.py
│   │   │   └── report_service.py
│   │   └── utils/               # 工具函数
│   │       ├── __init__.py
│   │       ├── word_parser.py
│   │       └── file_handler.py
│   ├── tests/                   # 后端测试
│   │   ├── __init__.py
│   │   ├── test_auth.py
│   │   ├── test_questions.py
│   │   └── test_papers.py
│   ├── scripts/                 # 数据库脚本
│   │   ├── init_db.sql
│   │   ├── create_paper_tables.sql
│   │   └── migrate_database.py
│   ├── reports/                 # 报告生成相关
│   │   ├── generators/
│   │   │   ├── __init__.py
│   │   │   ├── report_generator.py
│   │   │   ├── chart_generator.py
│   │   │   └── batch_generator.py
│   │   ├── templates/
│   │   │   ├── business_template.html
│   │   │   ├── business_template2.html
│   │   │   └── business_template3.html
│   │   └── assets/
│   │       └── logo.png
│   └── data/                    # 数据文件
│       ├── dimension_data.json
│       └── sample_data.xlsx
│
├── frontend/                    # 前端代码目录
│   ├── public/
│   │   └── index.html
│   ├── src/
│   │   ├── components/          # 通用组件
│   │   │   ├── Header.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   └── Loading.tsx
│   │   ├── pages/               # 页面组件
│   │   │   ├── Login.tsx
│   │   │   ├── admin/
│   │   │   │   ├── Dashboard.tsx
│   │   │   │   ├── QuestionManagement.tsx
│   │   │   │   ├── PaperManagement.tsx
│   │   │   │   ├── ParticipantManagement.tsx
│   │   │   │   └── ReportManagement.tsx
│   │   │   └── participant/
│   │   │       ├── Profile.tsx
│   │   │       ├── Assessment.tsx
│   │   │       └── Report.tsx
│   │   ├── layouts/             # 布局组件
│   │   │   ├── AdminLayout.tsx
│   │   │   └── ParticipantLayout.tsx
│   │   ├── services/            # API服务
│   │   │   ├── api.ts
│   │   │   ├── auth.ts
│   │   │   └── types.ts
│   │   ├── utils/               # 工具函数
│   │   │   ├── constants.ts
│   │   │   └── helpers.ts
│   │   ├── hooks/               # 自定义Hooks
│   │   │   └── useAuth.ts
│   │   ├── App.tsx
│   │   ├── main.tsx
│   │   ├── App.css
│   │   └── index.css
│   ├── tests/                   # 前端测试
│   │   ├── test_login.html
│   │   ├── test_assessment.html
│   │   └── test_profile.html
│   ├── package.json
│   ├── tsconfig.json
│   ├── vite.config.ts
│   └── README.md
│
├── docs/                        # 项目文档
│   ├── api.md                   # API文档
│   ├── deployment.md            # 部署说明
│   └── development.md           # 开发指南
│
└── docker/                      # Docker相关
    ├── Dockerfile.backend
    ├── Dockerfile.frontend
    └── nginx.conf
```

## 迁移步骤

### 第一阶段：创建新目录结构
1. 创建 `backend/` 和 `frontend/` 目录
2. 移动前端文件到 `frontend/` 目录
3. 移动后端文件到 `backend/` 目录

### 第二阶段：重构后端代码
1. 将 `app.py` 拆分为多个模块
2. 创建 `models/`, `schemas/`, `api/` 等目录
3. 移动数据库脚本到 `scripts/` 目录

### 第三阶段：整理测试文件

1. 移动测试文件到对应的 `tests/` 目录
2. 删除根目录的测试文件

### 第四阶段：配置文件整理

1. 创建统一的配置文件
2. 整理环境变量配置
3. 添加Docker支持

## 文件重命名建议

### 后端文件
- `app.py` → `backend/app/main.py`
- `generator.py` → `backend/reports/generators/report_generator.py`
- `chart_generator.py` → `backend/reports/generators/chart_generator.py`
- `batch_generation_from_excel.py` → `backend/reports/generators/batch_generator.py`

### 数据库脚本
- `db_init.sql` → `backend/scripts/init_db.sql`
- `create_paper_tables.sql` → `backend/scripts/create_paper_tables.sql`

### 测试文件
- `test_*.py` → `backend/tests/test_*.py`
- `test_*.html` → `frontend/tests/test_*.html`

## 配置文件建议

### 环境变量 (.env)

```env
# 数据库配置
DATABASE_URL=mysql+pymysql://root:password@localhost:3306/test_assessment
SECRET_KEY=your_secret_key

# 前端配置
VITE_API_BASE_URL=http://localhost:8000

# 文件存储
UPLOAD_DIR=./uploads
REPORT_DIR=./reports
```

### Docker配置
```yaml
# docker-compose.yml
version: '3.8'
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=mysql://root:password@db:3306/test_assessment
    depends_on:
      - db
  
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
  
  db:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_DATABASE=test_assessment
    volumes:
      - mysql_data:/var/lib/mysql

volumes:
  mysql_data:
```

## 开发流程建议

### 1. 分支策略
- `main`: 主分支，稳定版本
- `develop`: 开发分支
- `feature/*`: 功能分支
- `hotfix/*`: 热修复分支

### 2. 代码规范
- 后端：使用 Black 格式化，Flake8 检查
- 前端：使用 ESLint + Prettier
- 提交信息：使用 Conventional Commits

### 3. 测试策略
- 单元测试：后端 API 测试
- 集成测试：前后端联调测试
- E2E测试：用户流程测试

## 部署建议

### 开发环境
```bash
# 后端
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload

# 前端
cd frontend
npm install
npm run dev
```

### 生产环境
```bash
# 使用 Docker Compose
docker-compose up -d
```

## 总结

通过以上整理，项目将具有：
1. **清晰的分层结构** - 前后端分离，职责明确
2. **良好的可维护性** - 模块化设计，易于扩展
3. **规范的开发流程** - 统一的代码规范和测试策略
4. **便捷的部署方式** - Docker容器化部署
5. **完善的文档** - 详细的开发和使用文档

这样的结构将使项目更加专业、易于维护和扩展。 


当然可以！下面为你量身定制**main.py 拆分/重构最佳实践方案**，让你的 FastAPI 项目结构更清晰、可维护、无副作用，彻底杜绝路由消失等诡异问题。

---

# 一、推荐的 FastAPI 项目结构

```
backend/
  app/
    main.py              # 仅作为应用入口，注册全局依赖和所有路由
    core/
      database.py        # 数据库连接、get_db
      security.py        # 密码/JWT等安全相关
    models/
      user.py
      paper.py
      question.py
      ...                # 其它模型
    schemas/
      user.py
      paper.py
      question.py
      ...                # 其它Pydantic模型
    routers/
      users.py
      papers.py
      questions.py
      participants.py
      dimensions.py
      dashboard.py
      results.py
      ...                # 其它业务路由
    utils/
      ...                # 工具函数
```

---

# 二、拆分/重构步骤

## 1. **models 拆分**
- 将所有 SQLAlchemy ORM 模型（User, Paper, Question, PaperAssignment, Dimension 等）分别放到 `app/models/` 下的独立文件。
- 在 `app/models/__init__.py` 里统一 import，便于外部统一导入。

## 2. **schemas 拆分**
- 将所有 Pydantic 模型（UserOut, PaperOut, QuestionOut, ...）分别放到 `app/schemas/` 下的独立文件。
- 在 `app/schemas/__init__.py` 里统一 import。

## 3. **core 拆分**
- 数据库连接、get_db 放到 `app/core/database.py`。
- 密码加密、JWT、Token 相关放到 `app/core/security.py`。

## 4. **routers 拆分**
- 每个业务模块一个路由文件，如：
  - `app/routers/papers.py`：所有 /papers 相关路由
  - `app/routers/questions.py`：所有 /questions 相关路由
  - `app/routers/participants.py`：所有 /participants 相关路由
  - `app/routers/dimensions.py`：所有 /dimensions 相关路由
  - `app/routers/dashboard.py`：所有 /dashboard 相关路由
  - `app/routers/results.py`：所有 /results 相关路由
- 每个路由文件只负责注册自己的 APIRouter，不做 include_router。

## 5. **main.py 只做全局注册**
- 只负责：
  - 创建 FastAPI 实例
  - 注册全局中间件（如 CORS）
  - 注册全局依赖（如 get_db）
  - include_router（统一注册所有 routers 下的路由）
  - 注册全局事件（如 startup 路由打印）
- **绝不在 main.py 里写业务逻辑或模型定义！**

---

# 三、main.py 示例

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.routers import papers, questions, participants, dimensions, dashboard, results

app = FastAPI(title="人才测评平台API", description="后端服务")

# 全局中间件
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# 注册所有业务路由
app.include_router(papers.router)
app.include_router(questions.router)
app.include_router(participants.router)
app.include_router(dimensions.router)
app.include_router(dashboard.router)
app.include_router(results.router)

# 注册路由打印
from fastapi.routing import APIRoute
@app.on_event("startup")
def print_routes():
    print("\n=== FastAPI 路由注册信息 ===")
    for route in app.routes:
        if isinstance(route, APIRoute):
            print(f"{route.path}  |  {route.methods}  |  {route.name}")
    print("=== 路由打印结束 ===\n")
```

---

# 四、其它建议

- **绝不循环 import**：models、schemas、routers、core 之间只单向依赖，绝不互相 import。
- **所有 include_router 只在 main.py 统一注册**，其它地方只定义 APIRouter。
- **所有依赖、工具函数、全局异常处理都单独拆分**，绝不混在 main.py 或业务路由里。
- **每个 routers/ 下的路由文件只负责本业务，不 import 其它 router。**

---

# 五、迁移建议

1. 先将 models、schemas、core、routers 拆分到独立目录和文件。
2. main.py 只保留全局注册和 include_router。
3. 每次迁移一部分，main_demo.py 验证无误后再迁移下一部分。
4. 最终 main_demo.py 变成你的新 main.py，原 main.py 可废弃。

---

如需自动生成某个 routers/、models/、schemas/ 文件的模板，或需要迁移脚本、结构对比工具，请随时告诉我！  
**你只需专注于业务，结构优化和自动化我全包！**